(function(){var e,t,n;jQuery.fn.extend({imagepicker:function(t){if(t==null){t={}}return this.each(function(){var r;r=$(this);r.next("ul.image_picker_selector").remove();return r.data("picker",new e(this,n(t)))})}});n=function(e){var t;t={mode:"basic",hide_select:true,show_label:false};return jQuery.extend(t,e)};e=function(){function e(e,t){this.opts=t!=null?t:{};this.select=$(e);this.multiple=this.select.attr("multiple")==="multiple";this.build_and_append_picker()}e.prototype.has_implicit_blanks=function(){var e;return function(){var t,n,r,i;r=this.picker_options;i=[];for(t=0,n=r.length;t<n;t++){e=r[t];if(e.is_blank()&&!e.has_image()){i.push(e)}}return i}.call(this).length>0};e.prototype.build_and_append_picker=function(){if(this.opts.hide_select){this.select.hide()}this.select.change({picker:this},function(e){return e.data.picker.sync_picker_with_select()});if(this.picker!=null){this.picker.remove()}this.create_picker();this.select.after(this.picker);return this.sync_picker_with_select()};e.prototype.sync_picker_with_select=function(){var e,t,n,r,i;r=this.picker_options;i=[];for(t=0,n=r.length;t<n;t++){e=r[t];if(e.is_selected()){i.push(e.mark_as_selected())}else{i.push(e.unmark_as_selected())}}return i};e.prototype.create_picker=function(){var e,n,r,i;this.picker=$("<ul class='thumbnails image_picker_selector'></div>");this.picker_options=function(){var n,r,i,s;i=this.select.find("option");s=[];for(n=0,r=i.length;n<r;n++){e=i[n];s.push(new t(e,this,this.opts))}return s}.call(this);i=this.picker_options;for(n=0,r=i.length;n<r;n++){e=i[n];if(!e.has_image()){continue}this.picker.append(e.node)}return this.picker};return e}();t=function(){function e(e,t,n){this.picker=t;this.opts=n!=null?n:{};this.option=$(e);this.create_node()}e.prototype.has_image=function(){return this.option.data("img-src")!=null};e.prototype.is_blank=function(){return!(this.value()!=null&&this.value()!=="")};e.prototype.is_selected=function(){var e;e=this.picker.select.val();if(this.picker.multiple){return $.inArray(this.value(),e)>=0}else{return this.value()===e}};e.prototype.mark_as_selected=function(){return this.node.find(".thumbnail").addClass("selected")};e.prototype.unmark_as_selected=function(){return this.node.find(".thumbnail").removeClass("selected")};e.prototype.value=function(){return this.option.val()};e.prototype.label=function(){if(this.option.data("img-label")){return this.option.data("img-label")}else{return this.option.text()}};e.prototype.create_node=function(){var e,t;this.node=$("<li/>");e=$("<img class='image_picker_image'/>");e.attr("src",this.option.data("img-src"));t=$("<div class='thumbnail'>");t.click({picker:this.picker,option:this},function(e){var t,n;n=e.data.picker;t=e.data.option;if(n.multiple){if($.inArray(t.value(),n.select.val())>=0){t.option.prop("selected",false)}else{t.option.prop("selected",true)}}else{if(n.has_implicit_blanks()&&t.is_selected()){n.select.val("")}else{n.select.val(t.value())}}return n.sync_picker_with_select()});t.append(e);if(this.opts.show_label){t.append($("<p/>").html(this.label()))}this.node.append(t);return this.node};return e}()}).call(this)